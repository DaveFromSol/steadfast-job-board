<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Steadfast Staffing</title>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #2d3748;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Login Form Styles */
        .login-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }

        .login-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 400px;
        }

        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-header h2 {
            font-size: 2rem;
            color: #2d3748;
            margin-bottom: 10px;
        }

        .auth-error {
            background: #fed7d7;
            color: #c53030;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            display: none;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 10px;
        }

        .header p {
            color: #4a5568;
            font-size: 1.1rem;
        }

        .logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #e53e3e;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: #c53030;
            transform: translateY(-2px);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 1rem;
            color: #4a5568;
            font-weight: 500;
        }

        .sync-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 10px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }

        .sync-status.synced {
            color: #38a169;
            border: 2px solid #38a169;
        }

        .sync-status.syncing {
            color: #f6ad55;
            border: 2px solid #f6ad55;
        }

        .sync-status.error {
            color: #e53e3e;
            border: 2px solid #e53e3e;
        }

        .sync-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: currentColor;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
        }

        .jobs-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #2d3748;
        }

        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Poppins', sans-serif;
        }

        .btn:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }

        .btn:disabled {
            background: #a0aec0;
            cursor: not-allowed;
            transform: none;
        }

        .btn-danger {
            background: #e53e3e;
        }

        .btn-danger:hover {
            background: #c53030;
        }

        .btn-success {
            background: #38a169;
        }

        .btn-success:hover {
            background: #2f855a;
        }

        .search-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .search-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-family: 'Poppins', sans-serif;
            transition: border-color 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .filter-select {
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-family: 'Poppins', sans-serif;
            min-width: 150px;
        }

        .job-card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .job-card:hover {
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .job-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .job-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .job-meta {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }

        .job-badge {
            background: #667eea;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .job-badge.active {
            background: #38a169;
        }

        .job-badge.inactive {
            background: #e53e3e;
        }

        .job-actions {
            display: flex;
            gap: 8px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.85rem;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2d3748;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-family: 'Poppins', sans-serif;
            transition: border-color 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            margin: 50px auto;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #4a5568;
        }

        .analytics-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .chart-container {
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #4a5568;
            font-style: italic;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #4a5568;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .success-message {
            background: #c6f6d5;
            color: #22543d;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #9ae6b4;
        }

        .error-message {
            background: #fed7d7;
            color: #c53030;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #feb2b2;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }
            
            .search-controls {
                flex-direction: column;
            }
            
            .job-header {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Login Form -->
    <div id="loginContainer" class="login-container">
        <div class="login-card">
            <div class="login-header">
                <h2>Admin Login</h2>
                <p>Please sign in to access the admin panel</p>
            </div>
            <div id="authError" class="auth-error"></div>
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="loginEmail" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="loginPassword" required>
                </div>
                <button type="submit" class="btn" style="width: 100%;">Sign In</button>
            </form>
        </div>
    </div>

    <!-- Main Admin Panel -->
    <div id="adminPanel" class="container" style="display: none;">
        <button class="logout-btn" onclick="logout()">Logout</button>
        
        <div class="header">
            <h1>Steadfast Staffing Admin</h1>
            <p>Manage job postings, track analytics, and oversee your recruitment process</p>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalJobs">0</div>
                <div class="stat-label">Total Jobs</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="activeJobs">0</div>
                <div class="stat-label">Active Jobs</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalCategories">0</div>
                <div class="stat-label">Categories</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="recentApplications">0</div>
                <div class="stat-label">Recent Applications</div>
            </div>
        </div>

        <div class="main-content">
            <div class="jobs-section">
                <div class="section-header">
                    <h2 class="section-title">Job Management</h2>
                    <button class="btn" onclick="window.location.href='create-job.html'">Create New Job</button>
                </div>
                </div>
                <div class="search-controls">
                    <input type="text" class="search-input" id="searchJobs" placeholder="Search jobs...">
                    <select class="filter-select" id="categoryFilter">
                        <option value="">All Categories</option>
                    </select>
                    <select class="filter-select" id="statusFilter">
                        <option value="">All Status</option>
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                    </select>
                </div>

                <div id="jobsList">
                    <div class="loading">
                        <div class="spinner"></div>
                        Loading jobs...
                    </div>
                </div>
            </div>

            <div class="sidebar">
                <div class="analytics-card">
                    <h3 class="section-title">Quick Analytics</h3>
                    <div class="chart-container">
                        <div>
                            <p>ðŸ“Š Analytics Dashboard</p>
                            <p>Jobs by Category</p>
                            <p>Application Trends</p>
                            <p>Popular Locations</p>
                        </div>
                    </div>
                </div>

                <div class="form-card">
                    <h3 class="section-title">Quick Actions</h3>
                    <button class="btn btn-success" onclick="exportJobs()" style="width: 100%; margin-bottom: 10px;">
                        Export Jobs Data
                    </button>
                    <button class="btn" onclick="bulkUpdateStatus()" style="width: 100%; margin-bottom: 10px;">
                        Bulk Update Status
                    </button>
                    <button class="btn btn-danger" onclick="confirmBulkDelete()" style="width: 100%;">
                        Delete Inactive Jobs
                    </button>
                </div>
            </div>
        </div>

        <!-- Sync Status Indicator -->
        <div id="syncStatus" class="sync-status synced">
            <div class="sync-indicator"></div>
            <span id="syncText">Synced with Firebase</span>
        </div>
    </div>

    <!-- Add/Edit Job Modal -->
    <div id="jobModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Add New Job</h3>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            
            <div id="modalMessage"></div>
            
            <form id="jobForm">
                <div class="form-group">
                    <label class="form-label">Job Title *</label>
                    <input type="text" class="form-input" id="jobTitle" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Location *</label>
                    <input type="text" class="form-input" id="jobLocation" placeholder="City, State" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Job Type *</label>
                    <select class="form-input" id="jobType" required>
                        <option value="">Select Type</option>
                        <option value="Full-time">Full-time</option>
                        <option value="Part-time">Part-time</option>
                        <option value="Contract">Contract</option>
                        <option value="Temporary">Temporary</option>
                        <option value="Remote">Remote</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Category *</label>
                    <select class="form-input" id="jobCategory" required>
                        <option value="">Select Category</option>
                        <option value="Technology">Technology</option>
                        <option value="Healthcare">Healthcare</option>
                        <option value="Finance">Finance</option>
                        <option value="Marketing">Marketing</option>
                        <option value="Administration">Administration</option>
                        <option value="Customer Service">Customer Service</option>
                        <option value="Education">Education</option>
                        <option value="Manufacturing">Manufacturing</option>
                        <option value="Retail">Retail</option>
                        <option value="Warehouse & Logistics">Warehouse & Logistics</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Salary Range</label>
                    <input type="text" class="form-input" id="jobSalary" placeholder="e.g., $50,000 - $70,000">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Description *</label>
                    <textarea class="form-input form-textarea" id="jobDescription" required></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Requirements</label>
                    <textarea class="form-input form-textarea" id="jobRequirements"></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Application URL *</label>
                    <input type="url" class="form-input" id="jobApplyUrl" placeholder="https://..." required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Status</label>
                    <select class="form-input" id="jobStatus">
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                    </select>
                </div>
                
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button type="button" class="btn" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn btn-success" id="saveJobBtn">Save Job</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <script>
        // Firebase configuration - Your actual config
        const firebaseConfig = {
            apiKey: "AIzaSyDtgmr4F5uRh4M_6OVQAd-7X3ZyLqmS0-I",
            authDomain: "steadfast-staffing.firebaseapp.com",
            databaseURL: "https://steadfast-staffing-default-rtdb.firebaseio.com",
            projectId: "steadfast-staffing",
            storageBucket: "steadfast-staffing.firebasestorage.app",
            messagingSenderId: "447949048982",
            appId: "1:447949048982:web:ae07174035184d4d0a86b7"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        let jobs = [];
        let editingJobId = null;
        let currentUser = null;

        // Debug function to log errors
        function logError(message, error) {
            console.error(message, error);
            if (error && error.message) {
                showMessage(`${message}: ${error.message}`, 'error');
            } else {
                showMessage(message, 'error');
            }
        }

        // Authentication state observer
        auth.onAuthStateChanged((user) => {
            console.log('Auth state changed:', user);
            if (user) {
                currentUser = user;
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'block';
                init();
            } else {
                currentUser = null;
                document.getElementById('loginContainer').style.display = 'block';
                document.getElementById('adminPanel').style.display = 'none';
            }
        });

        // Add this function to your existing JavaScript
function openAddJobModal() {
    console.log('Opening add job modal');
    editingJobId = null;
    const modalTitle = document.getElementById('modalTitle');
    const jobForm = document.getElementById('jobForm');
    const jobStatus = document.getElementById('jobStatus');
    const modalMessage = document.getElementById('modalMessage');
    const jobModal = document.getElementById('jobModal');
    
    if (modalTitle) modalTitle.textContent = 'Add New Job';
    if (jobForm) jobForm.reset();
    if (jobStatus) jobStatus.value = 'active';
    if (modalMessage) modalMessage.innerHTML = '';
    if (jobModal) jobModal.style.display = 'block';
}

        // Login form handler
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            try {
                await auth.signInWithEmailAndPassword(email, password);
                document.getElementById('authError').style.display = 'none';
            } catch (error) {
                console.error('Login error:', error);
                document.getElementById('authError').textContent = error.message;
                document.getElementById('authError').style.display = 'block';
            }
        });

        // Logout function
        function logout() {
            auth.signOut();
        }

        // Initialize the application
        async function init() {
            console.log('Initializing app...');
            try {
                setupRealtimeSync();
                await loadJobs();
                populateFilters();
                updateStats();
                renderJobs();
                setupEventListeners();
                console.log('App initialized successfully');
            } catch (error) {
                logError('Error initializing app', error);
            }
        }

        // Setup real-time synchronization
        function setupRealtimeSync() {
            console.log('Setting up real-time sync...');
            
            // Listen for changes to all jobs
            database.ref('jobs').on('value', (snapshot) => {
                console.log('Jobs data received from Firebase');
                const data = snapshot.val();
                if (data) {
                    jobs = Object.keys(data).map(key => ({
                        id: key,
                        ...data[key]
                    }));
                    console.log('Jobs loaded:', jobs.length);
                } else {
                    jobs = [];
                    console.log('No jobs found in database');
                }
                
                // Update local state
                populateFilters();
                updateStats();
                renderJobs();
                updateSyncStatus('synced');
            }, (error) => {
                logError('Error in real-time sync', error);
                updateSyncStatus('error', 'Sync error');
            });

            // Monitor connection state
            database.ref('.info/connected').on('value', (snapshot) => {
                if (snapshot.val() === true) {
                    console.log('Connected to Firebase');
                    updateSyncStatus('synced');
                } else {
                    console.log('Disconnected from Firebase');
                    updateSyncStatus('error', 'Offline - changes will sync when reconnected');
                }
            });
        }

        // Update sync status indicator
        function updateSyncStatus(status, message = null) {
            const syncStatus = document.getElementById('syncStatus');
            const syncText = document.getElementById('syncText');
            
            if (!syncStatus || !syncText) return;
            
            syncStatus.className = 'sync-status ' + status;
            
            switch(status) {
                case 'synced':
                    syncText.textContent = message || 'Synced with Firebase';
                    break;
                case 'syncing':
                    syncText.textContent = message || 'Syncing...';
                    break;
                case 'error':
                    syncText.textContent = message || 'Sync error';
                    break;
            }
        }

        // Load jobs from Firebase
        async function loadJobs() {
            console.log('Loading jobs...');
            updateSyncStatus('syncing', 'Loading jobs...');
            try {
                const snapshot = await database.ref('jobs').once('value');
                const data = snapshot.val();
                
                if (data) {
                    jobs = Object.keys(data).map(key => ({
                        id: key,
                        ...data[key]
                    }));
                    console.log('Jobs loaded successfully:', jobs.length);
                } else {
                    jobs = [];
                    console.log('No jobs found');
                }
                
                updateSyncStatus('synced');
            } catch (error) {
                logError('Error loading jobs', error);
                updateSyncStatus('error', 'Failed to load jobs');
            }
        }

        // Save job to Firebase
        async function saveJobToFirebase(job, isNew = false) {
            console.log('Saving job to Firebase:', job);
            updateSyncStatus('syncing', 'Saving...');
            
            try {
                if (isNew) {
                    // Generate a new key for the job
                    const newJobRef = database.ref('jobs').push();
                    job.id = newJobRef.key;
                    console.log('Generated new job ID:', job.id);
                    await newJobRef.set(job);
                    console.log('New job saved successfully');
                } else {
                    // Update existing job
                    console.log('Updating existing job:', job.id);
                    await database.ref(`jobs/${job.id}`).set(job);
                    console.log('Job updated successfully');
                }
                
                updateSyncStatus('synced');
                return job;
            } catch (error) {
                logError('Error saving job', error);
                updateSyncStatus('error', 'Failed to save job');
                throw error;
            }
        }

        // Delete job from Firebase
        async function deleteJobFromFirebase(jobId) {
            console.log('Deleting job:', jobId);
            updateSyncStatus('syncing', 'Deleting...');
            
            try {
                await database.ref(`jobs/${jobId}`).remove();
                console.log('Job deleted successfully');
                updateSyncStatus('synced');
            } catch (error) {
                logError('Error deleting job', error);
                updateSyncStatus('error', 'Failed to delete job');
                throw error;
            }
        }

        // Populate filter dropdowns
        function populateFilters() {
            const categoryFilter = document.getElementById('categoryFilter');
            
            if (!categoryFilter) return;
            
            const categories = [...new Set(jobs.map(job => job.category).filter(cat => cat))];
            
            categoryFilter.innerHTML = '<option value="">All Categories</option>';
            categories.forEach(category => {
                categoryFilter.innerHTML += `<option value="${category}">${category}</option>`;
            });
        }

        // Update statistics
        function updateStats() {
            const totalJobs = jobs.length;
            const activeJobs = jobs.filter(job => job.status === 'active').length;
            const totalCategories = new Set(jobs.map(job => job.category).filter(cat => cat)).size;
            const recentApplications = Math.floor(Math.random() * 50) + 10; // Simulated
            
            const totalJobsEl = document.getElementById('totalJobs');
            const activeJobsEl = document.getElementById('activeJobs');
            const totalCategoriesEl = document.getElementById('totalCategories');
            const recentApplicationsEl = document.getElementById('recentApplications');
            
            if (totalJobsEl) totalJobsEl.textContent = totalJobs;
            if (activeJobsEl) activeJobsEl.textContent = activeJobs;
            if (totalCategoriesEl) totalCategoriesEl.textContent = totalCategories;
            if (recentApplicationsEl) recentApplicationsEl.textContent = recentApplications;
        }

        // Render jobs list
        function renderJobs() {
            const jobsList = document.getElementById('jobsList');
            if (!jobsList) return;
            
            const searchInput = document.getElementById('searchJobs');
            const categoryFilter = document.getElementById('categoryFilter');
            const statusFilter = document.getElementById('statusFilter');
            
            const searchTerm = searchInput ? searchInput.value.toLowerCase() : '';
            const categoryFilterValue = categoryFilter ? categoryFilter.value : '';
            const statusFilterValue = statusFilter ? statusFilter.value : '';
            
            let filteredJobs = jobs.filter(job => {
                const matchesSearch = !searchTerm || 
                    (job.title && job.title.toLowerCase().includes(searchTerm)) || 
                    (job.location && job.location.toLowerCase().includes(searchTerm)) ||
                    (job.description && job.description.toLowerCase().includes(searchTerm));
                const matchesCategory = !categoryFilterValue || job.category === categoryFilterValue;
                const matchesStatus = !statusFilterValue || job.status === statusFilterValue;
                
                return matchesSearch && matchesCategory && matchesStatus;
            });
            
            if (filteredJobs.length === 0) {
                jobsList.innerHTML = '<div class="loading">No jobs found matching your criteria.</div>';
                return;
            }
            
            jobsList.innerHTML = filteredJobs.map(job => `
                <div class="job-card">
                    <div class="job-header">
                        <div>
                            <div class="job-title">${job.title || 'Untitled Job'}</div>
                            <div class="job-meta">
                                <span class="job-badge">${job.location || 'Location TBD'}</span>
                                <span class="job-badge">${job.type || 'Type TBD'}</span>
                                <span class="job-badge">${job.category || 'Category TBD'}</span>
                                <span class="job-badge ${job.status || 'inactive'}">${(job.status || 'inactive').toUpperCase()}</span>
                                ${job.salary ? `<span class="job-badge">${job.salary}</span>` : ''}
                            </div>
                        </div>
                        <div class="job-actions">
                            <button class="btn btn-small" onclick="editJob('${job.id}')">Edit</button>
                            <button class="btn btn-small ${job.status === 'active' ? 'btn-danger' : 'btn-success'}" 
                                    onclick="toggleJobStatus('${job.id}')">
                                ${job.status === 'active' ? 'Deactivate' : 'Activate'}
                            </button>
                            <button class="btn btn-small btn-danger" onclick="deleteJob('${job.id}')">Delete</button>
                        </div>
                    </div>
                    <p style="margin-bottom: 10px; color: #4a5568;">${job.description || 'No description provided'}</p>
                    <small style="color: #718096;">Posted: ${job.datePosted ? new Date(job.datePosted).toLocaleDateString() : 'Unknown date'}</small>
                </div>
            `).join('');
        }

        // Setup event listeners
        function setupEventListeners() {
            const searchInput = document.getElementById('searchJobs');
            const categoryFilter = document.getElementById('categoryFilter');
            const statusFilter = document.getElementById('statusFilter');
            const jobForm = document.getElementById('jobForm');
            
            if (searchInput) searchInput.addEventListener('input', renderJobs);
            if (categoryFilter) categoryFilter.addEventListener('change', renderJobs);
            if (statusFilter) statusFilter.addEventListener('change', renderJobs);
            if (jobForm) jobForm.addEventListener('submit', handleJobSubmit);
        }

        // Modal functions
        function openAddJobModal() {
            console.log('Opening add job modal');
            editingJobId = null;
            const modalTitle = document.getElementById('modalTitle');
            const jobForm = document.getElementById('jobForm');
            const jobStatus = document.getElementById('jobStatus');
            const modalMessage = document.getElementById('modalMessage');
            const jobModal = document.getElementById('jobModal');
            
            if (modalTitle) modalTitle.textContent = 'Add New Job';
            if (jobForm) jobForm.reset();
            if (jobStatus) jobStatus.value = 'active';
            if (modalMessage) modalMessage.innerHTML = '';
            if (jobModal) jobModal.style.display = 'block';
        }

        function closeModal() {
            const jobModal = document.getElementById('jobModal');
            if (jobModal) jobModal.style.display = 'none';
        }

        // Geocoding function with better error handling
        async function geocodeLocation(location) {
            if (!location) return null;
            
            try {
                console.log('Geocoding location:', location);
                const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(location)}&limit=1`);
                
                if (!response.ok) {
                    console.warn('Geocoding request failed:', response.status);
                    return null;
                }
                
                const data = await response.json();
                if (data.length > 0) {
                    const coords = { lat: parseFloat(data[0].lat), lon: parseFloat(data[0].lon) };
                    console.log('Geocoded coordinates:', coords);
                    return coords;
                }
            } catch (error) {
                console.warn('Geocoding error:', error);
            }
            return null;
        }

        // Job CRUD operations
        async function handleJobSubmit(e) {
            e.preventDefault();
            console.log('Handling job submit');
            
            const saveBtn = document.getElementById('saveJobBtn');
            if (!saveBtn) return;
            
            saveBtn.disabled = true;
            saveBtn.textContent = 'Saving...';
            
            try {
                // Get form data
                const formData = {
                    title: document.getElementById('jobTitle')?.value || '',
                    location: document.getElementById('jobLocation')?.value || '',
                    type: document.getElementById('jobType')?.value || '',
                    category: document.getElementById('jobCategory')?.value || '',
                    salary: document.getElementById('jobSalary')?.value || '',
                    description: document.getElementById('jobDescription')?.value || '',
                    requirements: document.getElementById('jobRequirements')?.value || '',
                    apply: document.getElementById('jobApplyUrl')?.value || '',
                    status: document.getElementById('jobStatus')?.value || 'active'
                };
                
                console.log('Form data:', formData);
                
                // Validate required fields
                if (!formData.title || !formData.location || !formData.type || !formData.category || !formData.description || !formData.apply) {
                    throw new Error('Please fill in all required fields');
                }
                
                // Try to geocode the location (optional, don't fail if it doesn't work)
                try {
                    const coords = await geocodeLocation(formData.location);
                    if (coords) {
                        formData.lat = coords.lat;
                        formData.lon = coords.lon;
                    }
                } catch (geocodeError) {
                    console.warn('Geocoding failed, continuing without coordinates:', geocodeError);
                }
                
                if (editingJobId) {
                    // Update existing job
                    console.log('Updating existing job:', editingJobId);
                    const existingJob = jobs.find(job => job.id === editingJobId);
                    if (existingJob) {
                        const updatedJob = { ...existingJob, ...formData };
                        await saveJobToFirebase(updatedJob, false);
                        showMessage('Job updated successfully!', 'success');
                    } else {
                        throw new Error('Job not found for editing');
                    }
                } else {
                    // Add new job
                    console.log('Adding new job');
                    const newJob = {
                        ...formData,
                        datePosted: new Date().toISOString()
                    };
                    await saveJobToFirebase(newJob, true);
                    showMessage('Job added successfully!', 'success');
                }
                
                setTimeout(() => {
                    closeModal();
                }, 1500);
                
            } catch (error) {
                logError('Error saving job', error);
            } finally {
                saveBtn.disabled = false;
                saveBtn.textContent = 'Save Job';
            }
        }

        function editJob(jobId) {
            console.log('Editing job:', jobId);
            const job = jobs.find(j => j.id === jobId);
            if (!job) {
                console.error('Job not found:', jobId);
                return;
            }
            
            editingJobId = jobId;
            const modalTitle = document.getElementById('modalTitle');
            if (modalTitle) modalTitle.textContent = 'Edit Job';
            
            // Populate form
            const fields = {
                'jobTitle': job.title,
                'jobLocation': job.location,
                'jobType': job.type,
                'jobCategory': job.category,
                'jobSalary': job.salary,
                'jobDescription': job.description,
                'jobRequirements': job.requirements,
                'jobApplyUrl': job.apply,
                'jobStatus': job.status
            };
            
            Object.keys(fields).forEach(fieldId => {
                const element = document.getElementById(fieldId);
                if (element) {
                    element.value = fields[fieldId] || '';
                }
            });
            
            const modalMessage = document.getElementById('modalMessage');
            const jobModal = document.getElementById('jobModal');
            if (modalMessage) modalMessage.innerHTML = '';
            if (jobModal) jobModal.style.display = 'block';
        }

        async function toggleJobStatus(jobId) {
            console.log('Toggling job status:', jobId);
            try {
                const job = jobs.find(j => j.id === jobId);
                if (!job) {
                    console.error('Job not found:', jobId);
                    return;
                }
                
                const updatedJob = {
                    ...job,
                    status: job.status === 'active' ? 'inactive' : 'active'
                };
                
                await saveJobToFirebase(updatedJob, false);
                console.log('Job status toggled successfully');
            } catch (error) {
                logError('Error toggling job status', error);
            }
        }

        async function deleteJob(jobId) {
            console.log('Deleting job:', jobId);
            if (confirm('Are you sure you want to delete this job? This action cannot be undone.')) {
                try {
                    await deleteJobFromFirebase(jobId);
                    console.log('Job deleted successfully');
                } catch (error) {
                    logError('Error deleting job', error);
                }
            }
        }

        // Utility functions
        function showMessage(message, type) {
            console.log('Showing message:', message, type);
            const messageDiv = document.getElementById('modalMessage');
            if (messageDiv) {
                messageDiv.className = type === 'success' ? 'success-message' : 'error-message';
                messageDiv.textContent = message;
            }
        }

        // Bulk operations
        function exportJobs() {
            console.log('Exporting jobs');
            try {
                const dataStr = JSON.stringify(jobs, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = 'steadfast_jobs_export.json';
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                
                console.log('Export completed');
            } catch (error) {
                logError('Error exporting jobs', error);
            }
        }

        async function bulkUpdateStatus() {
            const status = prompt('Enter new status for all jobs (active/inactive):');
            if (status === 'active' || status === 'inactive') {
                try {
                    console.log('Bulk updating status to:', status);
                    updateSyncStatus('syncing', 'Updating all jobs...');
                    
                    // Update all jobs in Firebase
                    const updates = {};
                    jobs.forEach(job => {
                        updates[`jobs/${job.id}/status`] = status;
                    });
                    
                    await database.ref().update(updates);
                    alert(`All jobs updated to ${status} status.`);
                    console.log('Bulk update completed');
                } catch (error) {
                    logError('Error bulk updating', error);
                }
            }
        }

        async function confirmBulkDelete() {
            const inactiveJobs = jobs.filter(job => job.status === 'inactive');
            if (inactiveJobs.length === 0) {
                alert('No inactive jobs to delete.');
                return;
            }
            
            if (confirm(`Are you sure you want to delete ${inactiveJobs.length} inactive jobs? This cannot be undone.`)) {
                try {
                    console.log('Bulk deleting inactive jobs');
                    updateSyncStatus('syncing', 'Deleting inactive jobs...');
                    
                    // Delete all inactive jobs from Firebase
                    const updates = {};
                    inactiveJobs.forEach(job => {
                        updates[`jobs/${job.id}`] = null;
                    });
                    
                    await database.ref().update(updates);
                    alert(`${inactiveJobs.length} inactive jobs deleted.`);
                    console.log('Bulk delete completed');
                } catch (error) {
                    logError('Error bulk deleting', error);
                }
            }
        }

        // Close modal when clicking outside
        window.addEventListener('click', function(event) {
            const modal = document.getElementById('jobModal');
            if (event.target === modal) {
                closeModal();
            }
        });

        // Initialize the application when page loads
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM loaded, waiting for Firebase auth...');
            // Firebase will handle initialization via auth state observer
        });

        // Add some debugging for Firebase connection
        console.log('Firebase config loaded:', firebaseConfig);
        console.log('Firebase initialized successfully');
    </script>
</body>
</html>